<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barra Volume</title>
<style>
body {
  margin: 0;
  padding: 20px;
  background-color: black;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}

h1 {
  font-size: 50px;
  margin-top: 50px;
}

.numero-volume {
  font-size: 120px;
  font-weight: bold;
  color: cyan;
  margin: 50px 0;
}

.contenitore-barra {
  width: 90%;
  max-width: 600px;
  height: 100px;
  background-color: #333333;
  margin: 0 auto;
  border-radius: 50px;
  border: 5px solid white;
  overflow: hidden;
}

.barra-piena {
  height: 100%;
  width: 50%;
  background-color: cyan;
  transition: width 0.2s ease;
}

.testo {
  font-size: 30px;
  margin-top: 50px;
  color: yellow;
}

button {
  background-color: cyan;
  color: black;
  border: none;
  padding: 25px 60px;
  font-size: 35px;
  font-weight: bold;
  border-radius: 50px;
  margin-top: 30px;
  cursor: pointer;
}

.debug {
  position: fixed;
  bottom: 10px;
  left: 10px;
  right: 10px;
  background-color: rgba(50, 50, 50, 0.9);
  padding: 15px;
  border-radius: 10px;
  font-size: 18px;
  color: lime;
}
</style>
</head>
<body>

<h1>CONTROLLO VOLUME</h1>

<div class="numero-volume" id="numeroVolume">50</div>

<div class="contenitore-barra">
  <div class="barra-piena" id="barraVolume"></div>
</div>

<div class="testo" id="testoStato">Premi START per iniziare</div>

<button id="buttonStart" onclick="avviaSensori()">START</button>

<div class="debug" id="debugInfo">
  In attesa di avvio...<br>
  Gamma: 0°<br>
  Eventi ricevuti: 0
</div>

<script>
// Variabili globali
var volume = 50;
var attivo = false;
var ultimoGamma = 0;
var contatoreEventi = 0;

// Funzione per aggiornare la visualizzazione
function aggiornaVisualizzazione() {
  // Limita il volume tra 0 e 100
  if (volume < 0) volume = 0;
  if (volume > 100) volume = 100;
  
  // Aggiorna il numero
  document.getElementById('numeroVolume').textContent = Math.round(volume);
  
  // Aggiorna la larghezza della barra
  document.getElementById('barraVolume').style.width = volume + '%';
  
  // Cambia colore in base al livello
  var barra = document.getElementById('barraVolume');
  if (volume < 30) {
    barra.style.backgroundColor = 'red';
  } else if (volume < 70) {
    barra.style.backgroundColor = 'yellow';
  } else {
    barra.style.backgroundColor = 'cyan';
  }
}

// Funzione che gestisce l'orientamento del telefono
function gestioneOrientamento(evento) {
  contatoreEventi++;
  
  // Prendi il valore gamma (inclinazione sinistra/destra)
  var gamma = evento.gamma;
  
  // Aggiorna il debug
  document.getElementById('debugInfo').innerHTML = 
    'Sensore: ' + (attivo ? 'ATTIVO ✓' : 'IN PAUSA') + '<br>' +
    'Gamma: ' + (gamma ? gamma.toFixed(1) : 'NULL') + '°<br>' +
    'Eventi ricevuti: ' + contatoreEventi;
  
  // Se non è attivo o gamma è null, esci
  if (!attivo || gamma === null) return;
  
  // Calcola la differenza di inclinazione
  var differenza = gamma - ultimoGamma;
  
  // DESTRA (gamma aumenta) = volume SU - PIÙ SENSIBILE
  if (differenza > 1.5) {
    volume += 5;
    aggiornaVisualizzazione();
    document.getElementById('testoStato').textContent = '➡️ DESTRA - Volume: ' + Math.round(volume);
    document.getElementById('testoStato').style.color = 'lime';
  }
  // SINISTRA (gamma diminuisce) = volume GIÙ - PIÙ SENSIBILE
  else if (differenza < -1.5) {
    volume -= 5;
    aggiornaVisualizzazione();
    document.getElementById('testoStato').textContent = '⬅️ SINISTRA - Volume: ' + Math.round(volume);
    document.getElementById('testoStato').style.color = 'orange';
  }
  
  // Salva l'ultimo valore
  ultimoGamma = gamma;
}

// Funzione per avviare i sensori
function avviaSensori() {
  var button = document.getElementById('buttonStart');
  var testo = document.getElementById('testoStato');
  
  // Controlla se l'API esiste
  if (!window.DeviceOrientationEvent) {
    testo.textContent = '❌ ERRORE: Sensori non disponibili';
    testo.style.color = 'red';
    return;
  }
  
  // Per iOS serve richiedere permesso
  if (typeof DeviceOrientationEvent.requestPermission === 'function') {
    DeviceOrientationEvent.requestPermission()
      .then(function(risposta) {
        if (risposta === 'granted') {
          window.addEventListener('deviceorientation', gestioneOrientamento);
          attivo = true;
          button.style.display = 'none';
          testo.textContent = '✅ MUOVI IL TELEFONO A DESTRA E SINISTRA!';
          testo.style.color = 'lime';
        } else {
          testo.textContent = '❌ Permesso negato - Vai in Impostazioni Safari';
          testo.style.color = 'red';
        }
      })
      .catch(function(errore) {
        testo.textContent = '❌ Errore: ' + errore.message;
        testo.style.color = 'red';
      });
  } 
  // Per Android e altri
  else {
    window.addEventListener('deviceorientation', gestioneOrientamento);
    
    setTimeout(function() {
      attivo = true;
      button.style.display = 'none';
      testo.textContent = '✅ MUOVI IL TELEFONO A DESTRA E SINISTRA!';
      testo.style.color = 'lime';
      
      // Controlla dopo 3 secondi se funziona
      setTimeout(function() {
        if (contatoreEventi === 0) {
          testo.textContent = '⚠️ Sensore non risponde - Controlla permessi Chrome';
          testo.style.color = 'orange';
        }
      }, 3000);
    }, 500);
  }
}

// Inizializza la barra al caricamento
aggiornaVisualizzazione();
</script>
</body>
</html>

